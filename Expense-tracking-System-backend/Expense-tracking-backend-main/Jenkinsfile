pipeline {
    agent any
    
    tools {
        maven 'Maven-3.9.0' // Configure this in Jenkins Global Tool Configuration
        jdk 'JDK-17'        // Configure this in Jenkins Global Tool Configuration
    }
    
   environment {
    // Maven configuration (Java 8+ compatible)
    MAVEN_OPTS = '-Xmx3072m -XX:MetaspaceSize=256m -XX:MaxMetaspaceSize=512m -Djava.awt.headless=true'
    MAVEN_CLI_OPTS = '--batch-mode --errors --fail-at-end --show-version -DinstallAtEnd=true -DdeployAtEnd=true'
    
    // Build configuration
    SKIP_TESTS = 'true'
    PARALLEL_BUILD = 'true'
    
    // Logging
    BUILD_TIMESTAMP = bat(script: "@echo %date:~-4,4%-%date:~-10,2%-%date:~-7,2%_%time:~0,2%-%time:~3,2%-%time:~6,2%", returnStdout: true).trim()
    LOG_LEVEL = 'INFO'
}
    
    options {
        // Keep builds for 30 days or last 10 builds
        buildDiscarder(logRotator(numToKeepStr: '10', daysToKeepStr: '30'))
        
        // Timeout for entire pipeline
        timeout(time: 60, unit: 'MINUTES')
        
        // Disable concurrent builds
        disableConcurrentBuilds()
        
        // Add timestamps to console output
        timestamps()
    }
    
    parameters {
        string(
            name: 'BACKEND_BASE_PATH',
            defaultValue: 'C:\\Users\\jayapraj\\Downloads\\Expense-Tracking-system-With-User\\Expense-tracking-System-backend\\Expense-tracking-backend-main',
            description: 'Absolute path to backend services directory'
        )
        booleanParam(
            name: 'SKIP_TESTS', 
            defaultValue: true, 
            description: 'Skip running tests during build'
        )
        booleanParam(
            name: 'CLEAN_BUILD', 
            defaultValue: true, 
            description: 'Perform clean build (mvn clean)'
        )
        booleanParam(
            name: 'BUILD_ALL_SERVICES', 
            defaultValue: true, 
            description: 'Build all services in parallel'
        )
        choice( 
            name: 'LOG_LEVEL', 
            choices: ['INFO', 'DEBUG', 'WARN', 'ERROR'], 
            description: 'Maven build log level'
        )
    }
    
    stages {
        stage('ğŸ“‹ Initialization') {
            steps {
                script {
                    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo "ğŸš€ EXPENSE TRACKER BACKEND SERVICES - BUILD PIPELINE"
                    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo "ğŸ“… Build Date: ${BUILD_TIMESTAMP}"
                    echo "ğŸ”§ Jenkins Build: #${BUILD_NUMBER}"
                    echo "ğŸŒ¿ Branch: ${env.GIT_BRANCH ?: 'N/A'}"
                    echo "ğŸ‘¤ Started by: ${currentBuild.getBuildCauses()[0]?.userId ?: 'System'}"
                    echo "âš™ï¸  Skip Tests: ${params.SKIP_TESTS}"
                    echo "ğŸ§¹ Clean Build: ${params.CLEAN_BUILD}"
                    echo "ğŸ“Š Log Level: ${params.LOG_LEVEL}"
                    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    
                    // Set dynamic environment variables
                    env.SKIP_TESTS = params.SKIP_TESTS
                    env.CLEAN_BUILD = params.CLEAN_BUILD
                    env.LOG_LEVEL = params.LOG_LEVEL
                }
            }
        }
        
        stage('ğŸ” Pre-Build Validation') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘               PRE-BUILD VALIDATION                         â•‘"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    
                    // Check Maven installation
                    echo "âœ“ Checking Maven installation..."
                    bat 'mvn --version'
                    
                    // Check Java installation
                    echo "âœ“ Checking Java installation..."
                    bat 'java -version'
                    
                    // Check workspace
                    echo "âœ“ Checking backend base path..."
                    echo "ğŸ“‚ Backend Path: ${params.BACKEND_BASE_PATH}"
                    bat "dir \"${params.BACKEND_BASE_PATH}\" /b"
                    
                    echo "âœ… Pre-build validation completed successfully"
                }
            }
        }
        
        stage('ğŸ—ï¸  Build Services') {
            when {
                expression { params.BUILD_ALL_SERVICES }
            }
            parallel {
                stage('ğŸ” User Service') {
                    steps {
                        script {
                            buildService('user-service', 'ğŸ”')
                        }
                    }
                }
                
                stage('ğŸ“± Social Media App') {
                    steps {
                        script {
                            buildService('social-media-app', 'ğŸ“±')
                        }
                    }
                }
                
                stage('ğŸŒ Eureka Server') {
                    steps {
                        script {
                            buildService('eureka-server', 'ğŸŒ')
                        }
                    }
                }
                
                stage('ğŸšª Gateway') {
                    steps {
                        script {
                            buildService('Gateway', 'ğŸšª')
                        }
                    }
                }
                
                stage('ğŸ’° Budget Service') {
                    steps {
                        script {
                            buildService('Budget-Service', 'ğŸ’°')
                        }
                    }
                }
                
                stage('ğŸ“‹ Category Service') {
                    steps {
                        script {
                            buildService('Category-Service', 'ğŸ“‹')
                        }
                    }
                }
                
                stage('ğŸ’³ Payment Method Service') {
                    steps {
                        script {
                            buildService('Payment-method-Service', 'ğŸ’³')
                        }
                    }
                }
                
                stage('ğŸ§¾ Bill Service') {
                    steps {
                        script {
                            buildService('Bill-Service', 'ğŸ§¾')
                        }
                    }
                }
                
                stage('ğŸ”” Notification Service') {
                    steps {
                        script {
                            buildService('Notification-Service', 'ğŸ””')
                        }
                    }
                }
                
                stage('ğŸ‘¥ Friendship Service') {
                    steps {
                        script {
                            buildService('FriendShip-Service', 'ğŸ‘¥')
                        }
                    }
                }
                
                stage('ğŸ’¬ Chat Service') {
                    steps {
                        script {
                            buildService('Chat-Service', 'ğŸ’¬')
                        }
                    }
                }
                
                stage('ğŸ“… Event Service') {
                    steps {
                        script {
                            buildService('Event-Service', 'ğŸ“…')
                        }
                    }
                }
                
                stage('ğŸ” Audit Service') {
                    steps {
                        script {
                            buildService('Audit-Service', 'ğŸ”')
                        }
                    }
                }
                
                stage('ğŸ“Š Analytics Service') {
                    steps {
                        script {
                            buildService('AnalyticsService', 'ğŸ“Š')
                        }
                    }
                }
            }
        }
        
        stage('ğŸ“¦ Artifact Collection') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘              COLLECTING BUILD ARTIFACTS                    â•‘"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    
                    def services = [
                        'user-service', 'social-media-app', 'eureka-server', 'Gateway',
                        'Budget-Service', 'Category-Service', 'Payment-method-Service',
                        'Bill-Service', 'Notification-Service', 'FriendShip-Service',
                        'Chat-Service', 'Event-Service', 'Audit-Service', 'AnalyticsService'
                    ]
                    
                    services.each { service ->
                        def jarPath = "${params.BACKEND_BASE_PATH}\\${service}\\target\\*.jar"
                        def jarExists = bat(
                            script: "@echo off & if exist \"${jarPath}\" (echo FOUND) else (echo NOTFOUND)",
                            returnStdout: true
                        ).trim()
                        
                        if (jarExists.contains('FOUND')) {
                            echo "âœ“ ${service}: JAR found"
                            archiveArtifacts artifacts: "${params.BACKEND_BASE_PATH}\\${service}\\target\\*.jar", 
                                           allowEmptyArchive: true,
                                           fingerprint: true
                        } else {
                            echo "âš  ${service}: No JAR file found (might be a POM project)"
                        }
                    }
                    
                    echo "âœ… Artifact collection completed"
                }
            }
        }
        
        stage('ğŸ“Š Build Summary') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                   BUILD SUMMARY                            â•‘"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    
                    try {
                        // Safe calculation
                        long buildDurationMillis = currentBuild.duration ?: 0
                        long buildDurationSeconds = buildDurationMillis / 1000L
                        long minutes = buildDurationSeconds / 60L
                        long seconds = buildDurationSeconds % 60L
                        
                        echo "â±ï¸  Total Build Time: ${minutes}m ${seconds}s"
                        echo "ğŸ“Š Build Status: ${currentBuild.result ?: 'SUCCESS'}"
                        echo "ğŸ”¢ Build Number: #${BUILD_NUMBER}"
                        echo "ğŸ“… Timestamp: ${BUILD_TIMESTAMP}"
                        echo ""
                        echo "âœ… All services built successfully!"
                    } catch (Exception e) {
                        echo "âš ï¸  Could not calculate build duration: ${e.message}"
                    }
                    
                    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                }
            }
        }
        
        stage('ğŸ“ Copy JARs to Downloads') {
            steps {
                script {
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘            COPYING JARS TO DOWNLOADS FOLDER                â•‘"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    
                    // Create timestamp for folder name
                    def timestamp = new Date().format('yyyyMMdd_HHmmss')
                    def outputFolder = "C:\\Users\\jayapraj\\Downloads\\expense-tracker-jars-${timestamp}"
                    
                    echo "ğŸ“‚ Creating output folder: ${outputFolder}"
                    bat "mkdir \"${outputFolder}\""
                    
                    def services = [
                        'user-service', 'social-media-app', 'eureka-server', 'Gateway',
                        'Budget-Service', 'Category-Service', 'Payment-method-Service',
                        'Bill-Service', 'Notification-Service', 'FriendShip-Service',
                        'Chat-Service', 'Event-Service', 'Audit-Service', 'AnalyticsService'
                    ]
                    
                    def copiedCount = 0
                    
                    services.each { service ->
                        def sourcePath = "${params.BACKEND_BASE_PATH}\\${service}\\target"
                        echo "ğŸ” Checking ${service}..."
                        
                        // Check if target folder exists
                        def targetExists = bat(
                            script: "@echo off & if exist \"${sourcePath}\" (echo EXISTS) else (echo NOTFOUND)",
                            returnStdout: true
                        ).trim()
                        
                        if (targetExists.contains('EXISTS')) {
                            // Copy all JAR files from this service
                            def copyResult = bat(
                                script: "@echo off & xcopy \"${sourcePath}\\*.jar\" \"${outputFolder}\\\" /Y /Q 2>nul & echo COPIED",
                                returnStatus: true
                            )
                            
                            if (copyResult == 0) {
                                echo "âœ… ${service}: JAR copied"
                                copiedCount++
                            } else {
                                echo "âš ï¸  ${service}: No JAR file found or copy failed"
                            }
                        } else {
                            echo "âš ï¸  ${service}: Target folder not found"
                        }
                    }
                    
                    echo ""
                    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                    echo "â•‘                    COPY COMPLETE                           â•‘"
                    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    echo "ğŸ“Š Total JARs copied: ${copiedCount}"
                    echo "ğŸ“‚ Location: ${outputFolder}"
                    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                    
                    // Save the folder path for later reference
                    env.JAR_OUTPUT_FOLDER = outputFolder
                }
            }
        }
    }
    
    post {
        always {
            script {
                echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                echo "ğŸ§¹ CLEANUP AND FINALIZATION"
                echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            }
            
            // Clean up workspace if needed
            cleanWs(
                cleanWhenNotBuilt: false,
                deleteDirs: true,
                disableDeferredWipeout: true,
                notFailBuild: true,
                patterns: [
                    [pattern: '**/target', type: 'INCLUDE'],
                    [pattern: '**/.mvn', type: 'INCLUDE']
                ]
            )
        }
        
        success {
            script {
                echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                echo "â•‘                 âœ… BUILD SUCCESSFUL! âœ…                    â•‘"
                echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                echo "ğŸ‰ All backend services built successfully!"
                echo "ğŸ“¦ Build artifacts are ready for deployment"
                echo ""
                if (env.JAR_OUTPUT_FOLDER) {
                    echo "ğŸ“‚ All JAR files copied to:"
                    echo "   ${env.JAR_OUTPUT_FOLDER}"
                    echo ""
                    echo "ğŸ’¡ You can find all JARs in your Downloads folder!"
                }
                echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            }
            
            // Archive build logs
            archiveArtifacts artifacts: '**/*.log', allowEmptyArchive: true
        }
        
        failure {
            script {
                echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                echo "â•‘                  âŒ BUILD FAILED! âŒ                       â•‘"
                echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                echo "ğŸ’¥ One or more services failed to build"
                echo "ğŸ“‹ Check the logs above for detailed error messages"
                echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            }
            
            // Send notification (configure email/Slack as needed)
            // emailext (
            //     subject: "âŒ Build Failed: ${env.JOB_NAME} - #${env.BUILD_NUMBER}",
            //     body: "Build ${env.BUILD_NUMBER} failed. Check console output.",
            //     to: "${env.DEFAULT_RECIPIENTS}"
            // )
        }
        
        unstable {
            script {
                echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                echo "â•‘                 âš ï¸  BUILD UNSTABLE! âš ï¸                     â•‘"
                echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                echo "âš ï¸  Build completed with warnings"
                echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            }
        }
        
        aborted {
            script {
                echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
                echo "â•‘                  ğŸ›‘ BUILD ABORTED! ğŸ›‘                      â•‘"
                echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
                echo "Build was manually aborted"
                echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            }
        }
    }
}

// Helper function to build individual services
def buildService(String serviceName, String emoji = 'ğŸ“¦') {
    def startTime = System.currentTimeMillis()
    
    try {
        echo ""
        echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
        echo "â”‚ ${emoji} Building: ${serviceName}"
        echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
        
        def servicePath = "${params.BACKEND_BASE_PATH}\\${serviceName}"
        echo "ğŸ“ Service Path: ${servicePath}"
        
        dir(servicePath) {
            // Check if pom.xml exists
            if (!fileExists('pom.xml')) {
                echo "âš ï¸  WARNING: No pom.xml found for ${serviceName}, skipping..."
                return
            }
            
            echo "ğŸ“ Working Directory: ${pwd()}"
            
            // Determine Maven command
            def mvnCmd = 'mvn'
            def cleanPhase = params.CLEAN_BUILD ? 'clean' : ''
            def testSkip = params.SKIP_TESTS ? '-DskipTests' : ''
            
            // Build command
            def buildCommand = "${mvnCmd} ${cleanPhase} package ${testSkip} ${MAVEN_CLI_OPTS}"
            
            echo "ğŸ”¨ Executing: ${buildCommand}"
            echo "â³ Build in progress..."
            
            // Execute build (use bat for Windows)
            def buildResult = bat(
                script: buildCommand,
                returnStatus: true
            )
            
            // Calculate build time
            def endTime = System.currentTimeMillis()
            def duration = (endTime - startTime) / 1000
            
            if (buildResult == 0) {
                echo "âœ… ${serviceName} built successfully in ${duration}s"
                
                // Check for JAR file (Windows command)
                def jarFile = bat(
                    script: "@echo off & dir /b target\\*.jar 2>nul",
                    returnStdout: true
                ).trim()
                
                if (jarFile && jarFile != '') {
                    echo "ğŸ“¦ Artifact: ${jarFile}"
                }
                
                echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
            } else {
                echo "âŒ ${serviceName} build FAILED after ${duration}s"
                echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
                error("Build failed for ${serviceName}")
            }
        }
    } catch (Exception e) {
        echo "ğŸ’¥ ERROR in ${serviceName}: ${e.getMessage()}"
        echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
        throw e
    }
}

// Helper function for logging with levels
def log(String level, String message) {
    def timestamp = new Date().format('yyyy-MM-dd HH:mm:ss')
    def levelEmoji = [
        'DEBUG': 'ğŸ›',
        'INFO': 'â„¹ï¸',
        'WARN': 'âš ï¸',
        'ERROR': 'âŒ',
        'SUCCESS': 'âœ…'
    ]
    
    echo "[${timestamp}] ${levelEmoji[level] ?: 'ğŸ“'} [${level}] ${message}"
}
